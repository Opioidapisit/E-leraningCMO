<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏¢‡∏≤ ‡∏°.‡∏≠‡∏≠ ‡∏ï‡∏£‡∏±‡∏á</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
  <style>
    * { font-family: 'Kanit', sans-serif; }
    body { background: #e3f2fd; margin: 0; padding: 0; }
    .container { max-width: 800px; margin: auto; padding: 20px; }
    h1, h2, h3 { color: #1976d2; }
    button { padding: 10px 20px; margin-top: 10px; background: #2196f3; color: white; border: none; border-radius: 8px; cursor: pointer; }
    .question-box { margin: 20px 0; padding: 15px; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .choice { display: block; margin: 8px 0; }
    .hidden { display: none; }
    #resultBox { font-size: 1.2em; padding: 15px; margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏î‡πâ‡∏ß‡∏¢‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á ‡∏Ñ‡∏•‡∏¥‡∏ô‡∏¥‡∏Å‡∏¢‡∏≤ ‡∏°.‡∏≠‡∏≠ ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ï‡∏£‡∏±‡∏á üìòüíä</h1>
    <div id="loginBox">
      <h2>üë©‚Äç‚öïÔ∏è ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
      <input type="text" id="username" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ"><br><br>
      <input type="password" id="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô"><br><br>
      <button onclick="login()">üîê ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    </div>

    <div id="dashboard" class="hidden">
      <h2 id="welcomeText"></h2>
      <div id="quizStatus"></div>
      <button id="startQuizBtn" onclick="startQuiz()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö</button>
      <div id="quizBox" class="question-box hidden">
        <div id="questionText"></div>
        <div id="choicesContainer"></div>
        <button onclick="nextQuestion()">‡∏Ç‡πâ‡∏≠‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
      </div>
      <div id="resultBox" class="hidden"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script>
    const supabaseUrl = 'https://jrtpzuolfukhjxaylfyg.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpydHB6dW9sZnVraGp4YXlsZnlnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDk4NTQwODEsImV4cCI6MjA2NTQzMDA4MX0.2s-epXqs7f3jCzJolNqHPDXuB1B77iNIvN-26TVswLA';
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const users = {
      admin: { name: "Admin", password: "admin", role: "admin" },
      Ice: { name: "‡πÑ‡∏≠‡∏ã‡πå ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ô‡∏≤‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏û‡∏ä‡∏£", password: "001-1", role: "user" },
      // ‡πÄ‡∏û‡∏¥‡πà‡∏° user ‡∏≠‡∏∑‡πà‡∏ô‡πÑ‡∏î‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°...
    };

    let currentUser = null;
    let quiz = [];
    let currentIndex = 0;
    let score = 0;

    async function login() {
      const username = document.getElementById("username").value;
      const password = document.getElementById("password").value;

      if (users[username] && users[username].password === password) {
        currentUser = { id: username, ...users[username] };
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        document.getElementById("welcomeText").innerText = `‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö ${currentUser.name}`;
        checkResult();
      } else {
        alert("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
      }
    }

    async function checkResult() {
      const { data } = await supabase.from('quiz_results').select('*').eq('user_id', currentUser.id).single();
      if (data) {
        document.getElementById("quizStatus").innerText = `‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${data.status} (${data.score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô)`;
        if (data.status === '‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö') {
          document.getElementById("startQuizBtn").disabled = true;
        }
      } else {
        document.getElementById("quizStatus").innerText = '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏ó‡∏≥‡πÅ‡∏ö‡∏ö‡∏ó‡∏î‡∏™‡∏≠‡∏ö';
      }
    }

    async function startQuiz() {
      const { data, error } = await supabase.from('quiz').select('*').order('id');
      quiz = data;
      currentIndex = 0;
      score = 0;
      document.getElementById("quizBox").classList.remove("hidden");
      document.getElementById("startQuizBtn").classList.add("hidden");
      showQuestion();
    }

    function showQuestion() {
      const q = quiz[currentIndex];
      document.getElementById("questionText").innerText = `‡∏Ç‡πâ‡∏≠ ${currentIndex + 1}: ${q.question}`;
      const choices = [q.choice1, q.choice2, q.choice3, q.choice4];
      const container = document.getElementById("choicesContainer");
      container.innerHTML = "";
      choices.forEach((choice, idx) => {
        const btn = document.createElement("button");
        btn.innerText = choice;
        btn.className = "choice";
        btn.onclick = () => {
          if ((idx + 1) === q.correct) score++;
          nextQuestion();
        };
        container.appendChild(btn);
      });
    }

    function nextQuestion() {
      currentIndex++;
      if (currentIndex < quiz.length) {
        showQuestion();
      } else {
        finishQuiz();
      }
    }

    async function finishQuiz() {
      document.getElementById("quizBox").classList.add("hidden");
      document.getElementById("resultBox").classList.remove("hidden");
      const status = score >= 9 ? "‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö" : "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö";
      document.getElementById("resultBox").innerText = `‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ ${score} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô - ${status}`;
      alert(status === "‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö" ? "‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß!" : "‚ùå ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");

      await supabase.from('quiz_results').upsert([{ user_id: currentUser.id, score, status }]);
      checkResult();

      if (status === "‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ó‡∏î‡∏™‡∏≠‡∏ö") {
        document.getElementById("startQuizBtn").disabled = true;
      } else {
        document.getElementById("startQuizBtn").classList.remove("hidden");
      }
    }
  </script>
</body>
</html>
